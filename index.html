<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WORKOUT TRACKER</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/100/100344.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Proteksi Anti-Copy & Anti-Paste */
        body {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            font-family: 'Poppins', sans-serif;
            background-color: #000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=2070&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            opacity: 0.4;
            z-index: -1;
        }

        .glass-morphism {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .active-workout {
            position: relative;
            overflow: hidden;
            border: 2px solid #22c55e !important;
            transform: scale(1.02);
            background: rgba(34, 197, 94, 0.1) !important;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.85);
            display: none; 
            position: fixed;
            inset: 0;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -60%); }
            10% { opacity: 1; transform: translate(-50%, -50%); }
            90% { opacity: 1; transform: translate(-50%, -50%); }
            100% { opacity: 0; transform: translate(-50%, -40%); }
        }
        .toast-center {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            animation: fadeInOut 2.5s ease-in-out forwards;
            pointer-events: none;
        }
        
        select option {
            background-color: #1a1a1a;
            color: white;
        }
    </style>
</head>
<body oncontextmenu="return false" onkeydown="return disableKeys(event)">

    <div class="flex-grow flex items-center justify-center p-4">
        <div class="w-full max-w-[500px] glass-morphism p-6 md:p-8 shadow-2xl text-white relative">
            
            <!-- Icon Preset List (Top Right) -->
            <button onclick="openPresetModal()" class="absolute top-6 right-6 text-yellow-400 hover:text-yellow-300 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                </svg>
            </button>

            <header class="text-center mb-8 pr-10">
                <h1 class="text-2xl md:text-3xl font-bold uppercase tracking-widest text-yellow-400">WORKOUT TRACKER</h1>
                <p class="text-sm text-gray-400">Buat dan Lacak Latihan Olahraga Anda</p>
            </header>

            <!-- Bagian Atas: Form Input -->
            <section id="inputSection" class="space-y-4 mb-8">
                <div>
                    <label class="block text-sm font-semibold mb-1 text-gray-300">üé≠ Nama Workout (Min. 6 Huruf)</label>
                    <input type="text" id="workoutName" placeholder="Contoh: Jumping Jack" 
                        class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-yellow-500 outline-none text-white transition-all">
                </div>

                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-semibold mb-1 text-gray-300">üòà Tingkat Kesulitan</label>
                        <select id="difficulty" class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-yellow-500 outline-none text-white">
                            <option value="Mudah">Mudah</option>
                            <option value="Sedang">Sedang</option>
                            <option value="Sulit">Sulit</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1 text-gray-300">‚è≤ Durasi (Waktu)</label>
                        <div class="flex gap-2">
                            <select id="durationMin" class="flex-1 bg-black bg-opacity-50 border border-gray-700 rounded-lg px-2 py-2 focus:ring-2 focus:ring-yellow-500 outline-none text-white text-sm"></select>
                            <span class="flex items-center text-xs text-gray-400">Min</span>
                            <select id="durationSec" class="flex-1 bg-black bg-opacity-50 border border-gray-700 rounded-lg px-2 py-2 focus:ring-2 focus:ring-yellow-500 outline-none text-white text-sm"></select>
                            <span class="flex items-center text-xs text-gray-400">Det</span>
                        </div>
                    </div>
                </div>

                <div class="flex gap-2">
                    <button onclick="addWorkout()" class="flex-[2] bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 rounded-lg transition-all duration-300 transform active:scale-95 shadow-lg mt-2 text-sm">
                       +  ADD WORKOUT
                    </button>
                    <button onclick="openRestModal()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300 transform active:scale-100 shadow-lg mt-2 text-sm">
                        üò§ ADD REST
                    </button>
                </div>
            </section>

            <!-- Bagian Tengah: Daftar Workout -->
            <section>
                <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                    <h2 class="text-xl font-bold">Daftar Workout</h2>
                    <span id="timerDisplay" class="text-3xl font-mono text-yellow-400 hidden">00:00</span>
                </div>
                
                <div id="workoutList" class="space-y-3 max-h-60 overflow-y-auto pr-2 mb-6">
                    <p id="emptyMsg" class="text-center text-gray-500 italic text-sm">Belum ada daftar workout.</p>
                </div>

                <!-- Kontrol Utama -->
                <div id="mainControls" class="space-y-3">
                    <button id="btnStart" onclick="startWorkoutSession()" 
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl transition-all duration-300 shadow-xl border-2 border-green-400">
                        üèÉ‚Äç‚û°Ô∏è MULAI OLAHRAGA
                    </button>
                    <div class="flex">
                        <button onclick="openSavePresetModal()" 
                            class="w-full bg-gray-800 hover:bg-gray-700 text-green-400 font-bold py-4 rounded-xl transition-all duration-300 border border-gray-600 text-s tracking-widest uppercase">
                            + SIMPAN PRESET
                        </button>
                    </div>
                </div>

                <!-- Kontrol Sesi Berjalan -->
                <div id="activeControls" class="hidden flex gap-3">
                    <button id="btnPauseResume" onclick="togglePauseResume()" 
                        class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-4 rounded-xl transition-all duration-300 shadow-xl border-2 border-yellow-400">
                        JEDA
                    </button>
                    <button onclick="confirmStop()" 
                        class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl transition-all duration-300 shadow-xl border-2 border-red-400">
                        BERHENTI
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Save Preset Modal -->
    <div id="savePresetModal" class="modal-overlay">
        <div class="bg-gray-900 text-white p-8 rounded-2xl shadow-2xl w-full max-w-[400px] mx-4 border border-yellow-500">
            <h2 class="text-2xl font-bold mb-4 text-yellow-400">Simpan Preset</h2>
            <p class="text-xs text-gray-400 mb-4">Berikan nama untuk daftar workout ini agar bisa dimuat kembali nanti.</p>
            <input type="text" id="presetName" placeholder="Nama Preset (misal: Latihan Pagi)" 
                class="w-full bg-black border border-gray-700 rounded-lg px-4 py-2 mb-6 focus:ring-2 focus:ring-yellow-400 outline-none">
            <div class="flex gap-3">
                <button onclick="saveCurrentToPreset()" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 rounded-lg transition-all">SIMPAN</button>
                <button onclick="closeSavePresetModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition-all">BATAL</button>
            </div>
        </div>
    </div>

    <!-- Preset List Modal -->
    <div id="presetModal" class="modal-overlay">
        <div class="bg-gray-900 text-white p-8 rounded-2xl shadow-2xl w-full max-w-[450px] mx-4 border border-gray-700 flex flex-col max-h-[80vh]">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white-400">Daftar Preset</h2>
                <button onclick="closePresetModal()" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="presetItemsContainer" class="space-y-3 overflow-y-auto pr-2">
                <!-- Preset items go here -->
            </div>
            <p id="noPresetMsg" class="text-center text-gray-500 italic py-10 hidden">Belum ada preset yang disimpan.</p>
        </div>
    </div>

    <!-- Stop Modal -->
    <div id="stopModal" class="modal-overlay">
        <div class="bg-gray-900 text-white p-8 rounded-2xl shadow-2xl w-full max-w-[400px] mx-4 border border-red-500 text-center">
            <h2 class="text-2xl font-bold mb-4 text-red-500">Berhenti?</h2>
            <p class="mb-6 text-gray-300">Apakah Anda yakin ingin menghentikan sesi latihan saat ini? Progres tidak akan disimpan.</p>
            <div class="flex gap-3">
                <button onclick="stopWorkoutSession(true)" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg transition-all">IYA, BERHENTI</button>
                <button onclick="closeStopModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition-all">BATAL</button>
            </div>
        </div>
    </div>

    <!-- Rest Modal -->
    <div id="restModal" class="modal-overlay">
        <div class="bg-gray-900 text-white p-8 rounded-2xl shadow-2xl w-full max-w-[400px] mx-4 border border-blue-500">
            <h2 class="text-2xl font-bold mb-6 text-blue-400 text-center">Atur Waktu Istirahat</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-1">Durasi Istirahat (Min. 30 Detik)</label>
                    <div class="flex gap-2">
                        <select id="restDurationMin" class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-2 py-2 outline-none focus:ring-2 focus:ring-blue-400 text-sm"></select>
                        <span class="flex items-center text-xs text-gray-400">Min</span>
                        <select id="restDurationSec" class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-2 py-2 outline-none focus:ring-2 focus:ring-blue-400 text-sm"></select>
                        <span class="flex items-center text-xs text-gray-400">Det</span>
                    </div>
                </div>
                <div class="flex gap-3 pt-4">
                    <button onclick="addRestWorkout()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition-all">TAMBAHKAN</button>
                    <button onclick="closeRestModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition-all">BATAL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal-overlay">
        <div class="bg-gray-900 text-white p-8 rounded-2xl shadow-2xl w-full max-w-[400px] mx-4 border border-gray-700">
            <h2 class="text-2xl font-bold mb-6 text-yellow-400">Edit Workout</h2>
            <div class="space-y-4">
                <input type="hidden" id="editIndex">
                <div>
                    <label class="block text-sm font-semibold mb-1">Nama Kegiatan</label>
                    <input type="text" id="editWorkoutName" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 outline-none focus:ring-2 focus:ring-yellow-400">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1">‚è∞ Durasi (Minimal 30 Detik)</label>
                    <div class="flex gap-2">
                        <select id="editDurationMin" class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-2 py-2 outline-none focus:ring-2 focus:ring-yellow-400 text-sm"></select>
                        <span class="flex items-center text-xs">Min</span>
                        <select id="editDurationSec" class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-2 py-2 outline-none focus:ring-2 focus:ring-yellow-400 text-sm"></select>
                        <span class="flex items-center text-xs">Det</span>
                    </div>
                </div>
                <div class="flex gap-3 pt-4">
                    <button onclick="saveEdit()" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 rounded-lg transition-all">SIMPAN</button>
                    <button onclick="closeEditModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 rounded-lg transition-all">BATAL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Finish Modal -->
    <div id="finishModal" class="modal-overlay">
        <div class="bg-white text-gray-900 p-8 rounded-2xl shadow-2xl text-center max-w-sm mx-4">
            <div class="mb-4 text-green-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h2 class="text-2xl font-bold mb-2 uppercase">Selesai!</h2>
            <p class="mb-6 font-semibold">OLAHRAGA ANDA TELAH BERAKHIR!</p>
            <button onclick="closeModal()" class="bg-gray-900 hover:bg-black text-white px-8 py-2 rounded-lg font-bold transition-colors shadow-lg">
                TUTUP
            </button>
        </div>
    </div>

    <audio id="bellSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

    <footer class="w-full text-center py-4 bg-black bg-opacity-90 text-gray-400 text-xs tracking-widest mt-auto border-t border-gray-800">
        &copy; Made by JMC World 2026 - Powered by Gemini AI
    </footer>

    <script>
        // Data State
        let workouts = [];
        let presets = [];
        let isRunning = false;
        let isPaused = false;
        let currentIndex = 0;
        let timeLeft = 0;
        let timerInterval = null;

        // LOCAL STORAGE KEYS
        const STORAGE_KEY_WORKOUTS = 'jmc_current_workouts';
        const STORAGE_KEY_PRESETS = 'jmc_workout_presets';

        window.addEventListener('DOMContentLoaded', () => {
            populateTimeDropdowns('durationMin', 'durationSec');
            populateTimeDropdowns('editDurationMin', 'editDurationSec');
            populateTimeDropdowns('restDurationMin', 'restDurationSec');
            
            // LOAD DATA DARI LOCAL STORAGE
            loadFromLocalStorage();
            renderWorkouts();
        });

        function saveToLocalStorage() {
            localStorage.setItem(STORAGE_KEY_WORKOUTS, JSON.stringify(workouts));
        }

        function loadFromLocalStorage() {
            // Load Workouts Utama
            const savedWorkouts = localStorage.getItem(STORAGE_KEY_WORKOUTS);
            if (savedWorkouts) {
                workouts = JSON.parse(savedWorkouts);
            }

            // Load Presets
            const savedPresets = localStorage.getItem(STORAGE_KEY_PRESETS);
            if (savedPresets) {
                presets = JSON.parse(savedPresets);
            } else {
                presets = [];
            }
        }

        function populateTimeDropdowns(minId, secId) {
            const minSelect = document.getElementById(minId);
            const secSelect = document.getElementById(secId);
            for (let i = 0; i <= 15; i++) {
                const opt = document.createElement('option');
                opt.value = i; opt.innerText = i.toString().padStart(2, '0');
                minSelect.appendChild(opt);
            }
            for (let i = 0; i < 60; i++) {
                const opt = document.createElement('option');
                opt.value = i; opt.innerText = i.toString().padStart(2, '0');
                if (secId === 'durationSec' && i === 30) opt.selected = true; 
                if (secId === 'restDurationSec' && i === 30) opt.selected = true;
                secSelect.appendChild(opt);
            }
        }

        document.addEventListener('copy', (e) => e.preventDefault());
        document.addEventListener('paste', (e) => e.preventDefault());
        function disableKeys(e) {
            if (e.ctrlKey && (e.key === 'c' || e.key === 'v' || e.key === 'u' || e.key === 'i')) return false;
        }

        // PRESET LOGIC
        function openSavePresetModal() {
            if (isRunning) return;
            if (workouts.length === 0) {
                showToast("‚ùé Minimal terdaftar satu workout untuk simpan!", "error");
                return;
            }
            document.getElementById('savePresetModal').style.display = 'flex';
        }

        function closeSavePresetModal() {
            document.getElementById('savePresetModal').style.display = 'none';
            document.getElementById('presetName').value = "";
        }

        function saveCurrentToPreset() {
            const nameInput = document.getElementById('presetName');
            const name = nameInput.value.trim();
            if (!name) {
                showToast("Nama preset tidak boleh kosong!", "error");
                return;
            }
            
            const newPreset = {
                id: Date.now(),
                name: name,
                data: JSON.parse(JSON.stringify(workouts)) 
            };
            
            presets.push(newPreset);
            localStorage.setItem(STORAGE_KEY_PRESETS, JSON.stringify(presets));
            showToast("Preset Berhasil Disimpan", "success");
            closeSavePresetModal();
        }

        function openPresetModal() {
            if (isRunning) return;
            const container = document.getElementById('presetItemsContainer');
            const noMsg = document.getElementById('noPresetMsg');
            container.innerHTML = "";
            
            if (presets.length === 0) {
                noMsg.classList.remove('hidden');
            } else {
                noMsg.classList.add('hidden');
                presets.forEach(p => {
                    const div = document.createElement('div');
                    div.className = "bg-black bg-opacity-50 p-4 rounded-xl border border-gray-800 flex justify-between items-center group hover:border-yellow-500 transition-all";
                    div.innerHTML = `
                        <div>
                            <h3 class="font-bold text-yellow-400">${p.name}</h3>
                            <p class="text-xs text-gray-500">${p.data.length} Gerakan</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="loadPreset(${p.id})" class="bg-yellow-500 hover:bg-yellow-600 text-black px-3 py-1 rounded font-bold text-xs">MUAT</button>
                            <button onclick="deletePreset(${p.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded font-bold text-xs">HAPUS</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
            document.getElementById('presetModal').style.display = 'flex';
        }

        function closePresetModal() {
            document.getElementById('presetModal').style.display = 'none';
        }

        function loadPreset(id) {
            const preset = presets.find(p => p.id === id);
            if (preset) {
                workouts = JSON.parse(JSON.stringify(preset.data));
                saveToLocalStorage(); // Simpan sebagai daftar aktif saat ini
                renderWorkouts();
                closePresetModal();
                showToast(`Preset "${preset.name}" Dimuat`, "success");
            }
        }

        function deletePreset(id) {
            presets = presets.filter(p => p.id !== id);
            localStorage.setItem(STORAGE_KEY_PRESETS, JSON.stringify(presets));
            openPresetModal(); 
            showToast("Preset Dihapus", "info");
        }

        // WORKOUT LOGIC
        function addWorkout() {
            const nameInput = document.getElementById('workoutName');
            const diffInput = document.getElementById('difficulty');
            const minInput = document.getElementById('durationMin');
            const secInput = document.getElementById('durationSec');
            const name = nameInput.value.trim();
            const totalDuration = (parseInt(minInput.value) * 60) + parseInt(secInput.value);
            
            const alphabetOnly = /^[A-Za-z\s]+$/;
            if (name.length < 6 || !alphabetOnly.test(name)) {
                showToast("Nama workout minimal 6 huruf alfabet!", "error");
                return;
            }
            if (totalDuration < 30) {
                showToast("‚ùé Durasi minimal 30 detik!", "error");
                return;
            }

            workouts.push({ id: Date.now(), name: name, difficulty: diffInput.value, duration: totalDuration, isRest: false });
            
            saveToLocalStorage();
            renderWorkouts();
            
            nameInput.value = ""; minInput.value = 0; secInput.value = 30;
            showToast("Berhasil Ditambahkan", "success");
        }

        function openRestModal() {
            if (isRunning) return;
            document.getElementById('restModal').style.display = 'flex';
        }

        function closeRestModal() {
            document.getElementById('restModal').style.display = 'none';
        }

        function addRestWorkout() {
            const minVal = parseInt(document.getElementById('restDurationMin').value);
            const secVal = parseInt(document.getElementById('restDurationSec').value);
            const totalDuration = (minVal * 60) + secVal;

            if (totalDuration < 30) {
                showToast("‚ùé Istirahat minimal 30 detik!", "error");
                return;
            }

            workouts.push({ 
                id: Date.now(), 
                name: "Jeda Olahraga", 
                difficulty: "Break", 
                duration: totalDuration,
                isRest: true 
            });
            
            saveToLocalStorage();
            renderWorkouts();
            closeRestModal();
            showToast("‚úÖ Waktu istirahat ditambahkan", "success");
        }

        function renderWorkouts() {
            const list = document.getElementById('workoutList');
            if (workouts.length === 0) {
                list.innerHTML = `<p id="emptyMsg" class="text-center text-gray-500 italic text-sm py-4">Belum ada daftar workout.</p>`;
                return;
            }
            list.innerHTML = workouts.map((w, index) => {
                const m = Math.floor(w.duration / 60);
                const s = w.duration % 60;
                const isRest = w.isRest;
                return `
                    <div id="workout-item-${index}" class="flex justify-between items-center ${isRest ? 'bg-blue-900 bg-opacity-30' : 'bg-black bg-opacity-40'} p-4 rounded-lg border ${isRest ? 'border-blue-700' : 'border-gray-800'} transition-all ${isRunning && currentIndex === index ? 'active-workout' : ''}">
                        <div>
                            <h3 class="font-bold ${isRest ? 'text-blue-400' : 'text-yellow-400'} text-sm md:text-base">${w.name}</h3>
                            <p class="text-xs text-gray-400">${w.difficulty} ‚Ä¢ <span class="text-green-500 font-semibold">${m}m ${s}s</span></p>
                        </div>
                        <div class="flex gap-2 ${isRunning ? 'hidden' : ''}">
                            <button onclick="openEditModal(${index})" class="text-blue-400 hover:text-blue-200 text-xs font-semibold uppercase">Edit</button>
                            <button onclick="deleteWorkout(${index})" class="text-red-400 hover:text-red-200 text-xs font-semibold uppercase">Hapus</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteWorkout(index) {
            if (isRunning) return;
            workouts.splice(index, 1);
            saveToLocalStorage();
            renderWorkouts();
            showToast("Item dihapus", "info");
        }

        function openEditModal(index) {
            if (isRunning) return;
            const workout = workouts[index];
            document.getElementById('editIndex').value = index;
            document.getElementById('editWorkoutName').value = workout.name;
            document.getElementById('editDurationMin').value = Math.floor(workout.duration / 60);
            document.getElementById('editDurationSec').value = workout.duration % 60;
            document.getElementById('editModal').style.display = 'flex';
        }

        function closeEditModal() { document.getElementById('editModal').style.display = 'none'; }

        function saveEdit() {
            const index = document.getElementById('editIndex').value;
            const newName = document.getElementById('editWorkoutName').value.trim();
            const minVal = parseInt(document.getElementById('editDurationMin').value);
            const secVal = parseInt(document.getElementById('editDurationSec').value);
            const newTotalDuration = (minVal * 60) + secVal;
            
            if (newName.length < 6 && !workouts[index].isRest) { 
                showToast("Nama workout minimal 6 huruf!", "error"); 
                return; 
            }
            
            if (newTotalDuration < 30) { 
                showToast("Waktu minimal 30 detik!", "error"); 
                return; 
            }

            workouts[index].name = newName; 
            workouts[index].duration = newTotalDuration;
            
            saveToLocalStorage();
            renderWorkouts(); 
            closeEditModal(); 
            showToast("‚úÖ Perubahan disimpan", "success");
        }

        function confirmStop() {
            if (!isPaused) {
                pauseTimerLogic();
            }
            document.getElementById('stopModal').style.display = 'flex';
        }

        function closeStopModal() {
            document.getElementById('stopModal').style.display = 'none';
        }

        function startWorkoutSession() {
            if (workouts.length === 0) { showToast("Tambahkan workout terlebih dahulu!", "error"); return; }
            isRunning = true; isPaused = false; currentIndex = 0;
            toggleUIMode(true);
            showToast("Olahraga dimulai", "success");
            runTimer(true);
        }

        function togglePauseResume() {
            if (!isPaused) {
                pauseTimerLogic();
                showToast("Sesi Jeda", "info");
            } else {
                resumeTimerLogic();
                showToast("Sesi Dilanjutkan", "success");
            }
        }

        function pauseTimerLogic() {
            isPaused = true;
            clearInterval(timerInterval);
            const btn = document.getElementById('btnPauseResume');
            btn.innerText = "LANJUTKAN";
            btn.classList.replace('bg-yellow-600', 'bg-blue-600');
        }

        function resumeTimerLogic() {
            isPaused = false;
            const btn = document.getElementById('btnPauseResume');
            btn.innerText = "JEDA";
            btn.classList.replace('bg-blue-600', 'bg-yellow-600');
            startInterval();
        }

        function stopWorkoutSession(isUserForced = false) {
            clearInterval(timerInterval);
            isRunning = false;
            isPaused = false;
            currentIndex = 0;
            timeLeft = 0;
            
            closeStopModal();
            toggleUIMode(false);
            renderWorkouts();
            updateTimerDisplay(0);
            
            if (isUserForced) {
                showToast("Latihan dihentikan", "error");
                const btn = document.getElementById('btnPauseResume');
                btn.innerText = "JEDA";
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-yellow-600');
            }
        }

        function toggleUIMode(active) {
            document.getElementById('mainControls').classList.toggle('hidden', active);
            document.getElementById('activeControls').classList.toggle('hidden', !active);
            document.getElementById('inputSection').classList.toggle('opacity-30', active);
            document.getElementById('inputSection').classList.toggle('pointer-events-none', active);
            document.getElementById('timerDisplay').classList.toggle('hidden', !active);
        }

        function runTimer(isNewWorkout = false) {
            if (currentIndex >= workouts.length) {
                finishSession();
                return;
            }
            renderWorkouts();
            if (isNewWorkout) {
                timeLeft = workouts[currentIndex].duration;
            }
            updateTimerDisplay(timeLeft);
            startInterval();
        }

        function startInterval() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    timeLeft--;
                    updateTimerDisplay(timeLeft);
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        currentIndex++;
                        runTimer(true);
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay(seconds) {
            const display = document.getElementById('timerDisplay');
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            display.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function finishSession() {
            clearInterval(timerInterval);
            document.getElementById('bellSound').play().catch(() => {});
            document.getElementById('finishModal').style.display = 'flex';
            stopWorkoutSession(false);
        }

        function closeModal() { document.getElementById('finishModal').style.display = 'none'; }

        function showToast(msg, type = "info") {
            const toast = document.createElement('div');
            let bgColor = "bg-blue-600";
            let borderColor = "border-blue-400";
            if (type === "success") { bgColor = "bg-green-600"; borderColor = "border-green-400"; }
            else if (type === "error") { bgColor = "bg-red-600"; borderColor = "border-red-400"; }
            toast.className = `toast-center ${bgColor} text-white px-8 py-4 rounded-xl shadow-2xl font-bold text-center border-2 ${borderColor} min-w-[280px] md:min-w-[320px] text-sm md:text-base`;
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => { toast.remove(); }, 2500);
        }
    </script>
</\00\00\00
